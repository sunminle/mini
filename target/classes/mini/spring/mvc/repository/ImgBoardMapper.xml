<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "mini.spring.mvc.repository.ImgBoardMapper">
	
	
	<insert id="insert" parameterType="mini.spring.mvc.bean.ImgBoardDTO">
		insert into imgboard (num,writer,title,content,reg_date,isfile,firstimg) values(imgboard_seq.NEXTVAL,#{writer},#{title},#{content},sysdate,#{isfile},#{firstimg})
	</insert>
	
	<select id = "list" resultType="mini.spring.mvc.bean.ImgBoardDTO" parameterType="hashmap">
		<![CDATA[
			select * from (select b.*, rownum r from (select * from imgboard order by num desc)b) where r >= #{start} and r<= #{end}
		]]>
	</select>
	
	<select id = "listCount" >
		select NVL(count(num),0) from imgboard
	</select>
	
	<select id = "content" parameterType="mini.spring.mvc.bean.ImgBoardDTO">
		select * from imgboard where num = #{num}
	</select>
	
	<update id="readcountUp">
		update imgboard set readcount = readcount+1 where num = #{num}
	</update>
	
	<insert id = "fileInsert" parameterType="mini.spring.mvc.bean.ImgBoardFileDTO">
		insert into imgboard_file values (imgboard_file_seq.NEXTVAL, #{imgboardnum},#{filename})
	</insert>
	
	<select id = "maxNum" >
		select NVL(max(num),0) from imgboard
	</select>
	
	<select id="firstImgSelect" resultType="String">
		<![CDATA[
			(select * from (select filename from imgboard_file where imgboardnum = #{num} order by num asc) where rownum <= 1)
		]]>
	</select>
	
	<select id = "fileName">
		select filename from imgboard_file where imgboardnum = #{num}
	</select>
	
	
	
</mapper>